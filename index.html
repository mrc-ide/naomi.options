<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Contains model and calibration options and helper functions for Naomi • naomi.options</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Contains model and calibration options and helper functions for Naomi">
<meta property="og:description" content="Contains model and calibration option JSON and default values and helper functions for Naomi.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">naomi.options</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mrc-ide/naomi.options/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div class="section level1">
<div class="page-header"><h1 id="naomioptions">naomi.options<a class="anchor" aria-label="anchor" href="#naomioptions"></a>
</h1></div>
<!-- badges: start -->

<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>To install <code>naomi.options</code>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"mrc-ide/naomi.options"</span>, upgrade <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="terms">Terms<a class="anchor" aria-label="anchor" href="#terms"></a>
</h2>
<ul>
<li>control - the set of metadata describing one drop down or numeric entry in the options form, this includes info about the name, label, whether it is a required control, the options for the control, a default value etc. There are 3 types of controls, select (for a drop down with 1 value), multiselect (a dropdown with multiple values), numeric for a number</li>
<li>options - the individual options for select and multiselect controls (i.e. the set of all possible values the control can take)</li>
<li>fallback - a backup default value for a control which can be used if the hardcoded default in the defaults csv is invalid</li>
</ul>
</div>
<div class="section level2">
<h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h2>
<p><img src="diagram/logic.png?raw=true"></p>
<p>There are 2 possible sources for default values, in order of precedence * <code>default_options.csv</code> * <code>fallback_values</code> coming from the data</p>
<p>When building the options from hintr the way this works is 1. hintr receives a request to return options with paths to files 1. hintr reads files and pulls out options and default values from the data 1. hintr calls naomi.options <code>get_controls_json</code> with the <code>iso3</code> the <code>options</code> from the data and <code>fallback_values</code> from the data. Note the <code>options</code> and <code>fallback_values</code> can be empty and indeed are for calibrate options 1. naomi.options reads the controls from <code>controls.R</code> for this type, and adds any <code>options</code> passed as an arg into this list for each <code>control</code> 1. naomi.options reads the default values from <code>default_options.csv</code> 1. For each control, naomi.options checks if csv value is valid and if it is sets this as the <code>value</code> for the control. If it is invalid it checks if there is a default in the <code>fallback_values</code> if not uses an empty default <code>value</code> 1. naomi.options takes the completed set of controls, serializes them to JSON and embeds them in the options json from <code>inst/model_options.json</code> or <code>inst/calibration_options.json</code> and returns to hintr 1. hintr returns json back as response</p>
</div>
<div class="section level2">
<h2 id="change-the-default-value-of-a-control">Change the default value of a control<a class="anchor" aria-label="anchor" href="#change-the-default-value-of-a-control"></a>
</h2>
<p>Update the <code>inst/default_options.csv</code>. There is a row for each country and a column with the ID of the control. Note * To set an empty value you can use “” or just empty in the <code>default_options.csv</code> * To set multiple default values for multiselect controls separate the values with a <code>;</code> and any amount of whitespace e.g. <code>CMR2018DHS; CMR2017PHIA</code> or <code>CMR2018DHS;CMR2017PHIA</code> will work * To set a value to use the default from the data overrides set the cell to <code>NA</code></p>
<p>After making any changes run the tests, this will check that the value added is valid and of the correct value for the type.</p>
</div>
<div class="section level2">
<h2 id="add-a-new-control">Add a new control<a class="anchor" aria-label="anchor" href="#add-a-new-control"></a>
</h2>
<p>To add a new control requires a few steps 1. Add the control to the list of controls in either <code>get_model_controls()</code> or <code>get_calibration_controls()</code> in <code>R/controls.R</code>. Adding it as a <code>control()</code> will validate that the control specification is well formed 1. Add it into the json template. This sets where the control is shown on the options page relative to the other controls. Add it to either <code>inst/anc_options.json</code>, <code>inst/art_options.json</code>, <code>inst/model_options.json</code> or <code>inst/calibration_options.json</code>. You may need to add a new label or control group. To add the control itself use the name added in step 1 as <code>"&lt;+control_name+&gt;"</code>. This string then gets matched and replaced with the control specification from step 1. Comparing this JSON to the options in the app is often the easiest way to see what the different labels and descriptions do but ask Rob if any questions. 1. Set default value, add a new column to <code>inst/default_options.csv</code> and set values for each country. 1. Add traduire strings for any label, description or help text added 1. If the new control is a “select” or “multiselect” type where the possible options come from the data then this data will need to be prepared and sent in call to <code>naomi.options</code>. Talk to Rob and ask him to do this.</p>
</div>
<div class="section level2">
<h2 id="update-schema-for-testing">Update schema for testing<a class="anchor" aria-label="anchor" href="#update-schema-for-testing"></a>
</h2>
<p>The package validates that the options for every country produces valid options. To do this we re-use the schema from hintr. This will need to be updated periodically if the schema changes by running the script</p>
<pre><code><span><span class="va">.</span><span class="op">/</span><span class="va">scripts</span><span class="op">/</span><span class="va">copy_schemas</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="license">License<a class="anchor" aria-label="anchor" href="#license"></a>
</h2>
<p>MIT © Imperial College of Science, Technology and Medicine</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/mrc-ide/naomi.options/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/mrc-ide/naomi.options/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing naomi.options</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Robert Ashton <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://www.repostatus.org/#concept" class="external-link"><img src="https://www.repostatus.org/badges/latest/concept.svg" alt="Project Status: Concept – Minimal or no implementation has been done yet, or the repository is only intended to be a limited example, demo, or proof-of-concept."></a></li>
<li><a href="https://github.com/mrc-ide/naomi.options/actions" class="external-link"><img src="https://github.com/mrc-ide/naomi.options/workflows/R-CMD-check/badge.svg" alt="R build status"></a></li>
<li><a href="https://codecov.io/github/mrc-ide/naomi.options?branch=main" class="external-link"><img src="https://codecov.io/github/mrc-ide/naomi.options/coverage.svg?branch=main" alt="codecov.io"></a></li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Robert Ashton.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
